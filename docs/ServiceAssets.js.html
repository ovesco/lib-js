<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ServiceAssets.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ServiceAssets.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const utils = require('./utils.js');
/**
 * Holds Pryv Service informations.
 * 
 * It's returned by `service.assets()`
 *
 * @memberof Pryv
 **/
class ServiceAssets {
  /**
   * Private => use ServiceAssets.setup()
   * @param { object} assets The content of service/info.assets properties.
   * @param { string } pryvServiceAssetsSourceUrl Url point to assets of the service of a Pryv platform: https://api.pryv.com/reference/#service-info property `assets.src`
   */
  constructor(assets, assetsURL) {
    this._assets = assets;
    this._assetsURL = assetsURL;
  }

  /**
   * Load Assets definition
   * @param {string} pryvServiceAssetsSourceUrl
   * @returns {ServiceAssets}
   */
  static async setup(pryvServiceAssetsSourceUrl) {
    const res = await utils.superagent.get(pryvServiceAssetsSourceUrl).set('accept', 'json');
    return new ServiceAssets(res.body, pryvServiceAssetsSourceUrl);
  }

  /**
   * get a value from path separated by `:`
   * exemple of key `lib-js:buttonSignIn`
   * @param {string} [keyPath] if null, will return the all assets  
   */
  get(keyPath) {
    let result = Object.assign({}, this._assets);
    if (keyPath) {
      keyPath.split(':').forEach((key) => {
        result = result[key];
        if (typeof result === 'undefined') return result;
      });
    }
    return result;
  }

  /**
   * get an Url from path separated by `:`
   * identical to doing assets.relativeURL(assets.get(keyPath))
   * exemple of key `lib-js:buttonSignIn`
   * @param {string} [keyPath] if null, will return the all assets  
   */
  getUrl(keyPath) {
    const url = this.get(keyPath);
    if (typeof url !== 'string') {
      throw new Error(url + ' returned ' + value); 
    }
    return this.relativeURL(url);
  }

  /**
   * get relativeUrl
   */
  relativeURL(url) {
    return relPathToAbs(this._assets.baseUrl || this._assetsURL, url);
  }

  //----------------   Default service ressources
  
  /**
   * Set all defaults Favicon, CSS
   */
  async setAllDefaults() {
    this.setFavicon();
    await this.loadCSS();
  }

  /**
   * Set service Favicon to Web Page
   */
  setFavicon() {
    var link = document.querySelector("link[rel*='icon']") || document.createElement('link');
    link.type = 'image/x-icon';
    link.rel = 'shortcut icon';
    link.href = this.relativeURL(this._assets.favicon.default.url);
    document.getElementsByTagName('head')[0].appendChild(link);
  }

  /**
   * Set default service CSS
   */
  async loadCSS() {
    loadCSS(this.relativeURL(this._assets.css.default.url));
  }

  // ---- Login

  /**
  * Load CSS for Login button
  */
  async loginButtonLoadCSS () {
    loadCSS(this.relativeURL(this._assets['lib-js'].buttonSignIn.css));
  }

  /**
  * Get HTML for Login Button
  */
  async loginButtonGetHTML() {
    const res = await utils.superagent.get(this.relativeURL(this._assets['lib-js'].buttonSignIn.html)).set('accept', 'html');
    return res.text;
  }

 /**
 * Get Messages strings for Login Button
 */
  async loginButtonGetMessages() {
    const res = await utils.superagent.get(this.relativeURL(this._assets['lib-js'].buttonSignIn.messages)).set('accept', 'json');
    return res.body;
  }

}

function loadCSS(url) {
  var head = document.getElementsByTagName('head')[0];
  var link = document.createElement('link');
  link.id = url;
  link.rel = 'stylesheet';
  link.type = 'text/css';
  link.href = url;
  link.media = 'all';
  head.appendChild(link);
}

  /*\
  |*| Modified version of 
  |*| :: translate relative paths to absolute paths ::
  |*|
  |*| https://developer.mozilla.org/en-US/docs/Web/API/document.cookie
  |*|
  |*| The following code is released under the GNU Public License, version 3 or later.
  |*| http://www.gnu.org/licenses/gpl-3.0-standalone.html
  |*|
  \*/

function relPathToAbs (baseUrlString, sRelPath) {
  var baseLocation = location;
  if (baseUrlString) {
    baseLocation = document.createElement('a');
    baseLocation.href = baseUrlString;
  }

  var nUpLn, sDir = "", sPath = baseLocation.pathname.replace(/[^\/]*$/, sRelPath.replace(/(\/|^)(?:\.?\/+)+/g, "$1"));
  for (var nEnd, nStart = 0; nEnd = sPath.indexOf("/../", nStart), nEnd > -1; nStart = nEnd + nUpLn) {
    nUpLn = /^\/(?:\.\.\/)*/.exec(sPath.slice(nEnd))[0].length;
    sDir = (sDir + sPath.substring(nStart, nEnd)).replace(new RegExp("(?:\\\/+[^\\\/]*){0," + ((nUpLn - 1) / 3) + "}$"),
      "/");
  }
  let portStr = baseLocation.port ? ':' + baseLocation.port : '';
  return baseLocation.protocol + '//' + baseLocation.hostname + portStr + sDir + sPath.substr(nStart);
}


module.exports = ServiceAssets;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Pryv.html">Pryv</a></li></ul><h3>Namespaces</h3><ul><li><a href="Pryv.Auth.html">Auth</a></li><li><a href="Pryv.Browser.html">Browser</a></li><li><a href="Pryv.Browser.CookieUtils.html">CookieUtils</a></li><li><a href="Pryv.utils.html">utils</a></li></ul><h3>Classes</h3><ul><li><a href="Pryv.Browser.LoginButton.html">LoginButton</a></li><li><a href="Pryv.Connection.html">Connection</a></li><li><a href="Pryv.Service.html">Service</a></li><li><a href="Pryv.ServiceAssets.html">ServiceAssets</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getServiceInfoFromURL">getServiceInfoFromURL</a></li><li><a href="global.html#loadAssets">loadAssets</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Mon May 10 2021 08:30:38 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
